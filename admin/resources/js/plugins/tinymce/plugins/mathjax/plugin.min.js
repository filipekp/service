/**
 * editor_plugin_src.js
 *
 * Copyright 2009, Etienne Florent (contributing)
 * Released under LGPL License.
 *
 * License: http://tinymce.moxiecode.com/license
 * Contributing: http://tinymce.moxiecode.com/contributing
 */

//@TODO gérer le passage en mode plein écran lorsqu'une formule est en cours d'édition.

tinymce.PluginManager.add('mathjax',function(editor, url) {
    function _mathjaxInit(url){
      var t = tinymce;
      
      console.log('tu');
      
      //On charge la feuille de style qui gère le rendu des formules en cours d'édition
      tinymce.DOM.loadCSS(url+'/css/mathjax.css');

      //var sl = new tinymce.DOM.ScriptLoader();

      //infos de configuration pour MathJax
      /*var script1 = tinymce.DOM.create('script',{
          type:"text/x-mathjax-config"
      },t.config);*/
      //Chargement du script principal via le CDN (et si jamais le CDN de MathJax était indisponible ?)
      //sl.add("http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_HTMLorMML,"+url+"/js/macro");
      
      /*var head = doc.getElementsByTagName("head")[0];
      head.appendChild(script1);
      head.appendChild(script2);*/

      //MathJax peut mettre un certain temps avant d'être prêt ...
      /*var timeId = setTimeout(function(){
        if(win.MathJax && win.MathJax.Hub.queue) {
          t.MathJax = win.MathJax;
          //pour la synchronisation : mettre une (ou des) fonction de rappel f dans la queue -> queue.Push(function(){f()},...).
          t.queue = t.MathJax.Hub.queue;

          //lorsqu'on est en mode plein écran
          if(t.parent && t.parent.actif) {
              //sert à mettre à jour le compteur ID de MathJax.ElementJax ; 
              //à ne faire qu'après s'être occupé de la boite de prévisualisation (ainsi son ID sera 1)
              t.actif = true;
              t.mathBox = null;
              t._globalMathTypeset(t.parent.MathJax.ElementJax.ID,t.parent.MathJax.OutputJax["HTML-CSS"].ID);
          }
          t.onMathjaxReady.dispatch();

          //l'initialisation est achevée, inutile de la répéter ...
          win.clearInterval(timeId);
        }
      },1);*/
    }
    
    _mathjaxInit(url);
});
